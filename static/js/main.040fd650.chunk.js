(window.webpackJsonpqrpeer=window.webpackJsonpqrpeer||[]).push([[0],{11:function(e){e.exports=JSON.parse('["ACE","AFRICA","AGENT","AIR","ALASKA","ALIEN","ALPS","AMAZON","AMBULANCE","AMERICA","ANCHOR","ANGEL","ANT","ANTARCTICA","ANTHEM","APPLE","APRON","ARM","ARMOR","ARMY","ASH","ASTRONAUT","ATLANTIS","ATTIC","AUSTRALIA","AVALANCHE","AXE","AZTEC","BABY","BACK","BACON","BALL","BALLOON","BANANA","BAND","BANK","BAR","BARBECUE","BARK","BASS","BAT","BATH","BATTERY","BATTLE","BATTLESHIP","BAY","BEACH","BEAM","BEAN","BEAR","BEARD","BEAT","BED","BEE","BEER","BEIJING","BELL","BELT","BENCH","BERLIN","BERMUDA","BERRY","BICYCLE","BIG BANG","BIG BEN","BIKINI","BILL","BISCUIT","BLACKSMITH","BLADE","BLIND","BLIZZARD","BLOCK","BLUES","BOARD","BOIL","BOLT","BOMB","BOND","BONSAI","BOOK","BOOM","BOOT","BOSS","BOTTLE","BOW","BOWL","BOWLER","BOX","BOXER","BRAIN","BRASS","BRAZIL","BREAD","BREAK","BRICK","BRIDE","BRIDGE","BROTHER","BRUSH","BUBBLE","BUCK","BUCKET","BUFFALO","BUG","BUGLE","BULB","BUNK","BUTTER","BUTTERFLY","BUTTON","CABLE","CAESAR","CAKE","CALF","CAMP","CANADA","CANE","CAP","CAPITAL","CAPTAIN","CAR","CARD","CARROT","CASINO","CAST","CASTLE","CAT","CAVE","CELL","CENTAUR","CENTER","CHAIN","CHAIR","CHALK","CHANGE","CHARGE","CHECK","CHEESE","CHERRY","CHEST","CHICK","CHINA","CHIP","CHOCOLATE","CHRISTMAS","CHURCH","CIRCLE","CLEOPATRA","CLIFF","CLOAK","CLOCK","CLOUD","CLUB","COACH","COAST","CODE","COFFEE","COLD","COLLAR","COLUMBUS","COMB","COMET","COMIC","COMPOUND","COMPUTER","CONCERT","CONDUCTOR","CONE","CONTRACT","COOK","COPPER","COTTON","COUNTRY","COURT","COVER","COW","COWBOY","CRAB","CRAFT","CRANE","CRASH","CRICKET","CROSS","CROW","CROWN","CRUSADER","CRYSTAL","CUCKOO","CURRY","CYCLE","CZECH","DANCE","DASH","DATE","DAY","DEATH","DECK","DEGREE","DELTA","DENTIST","DESK","DIAMOND","DICE","DINOSAUR","DIRECTOR","DISEASE","DISK","DOCTOR","DOG","DOLL","DOLLAR","DOOR","DRAFT","DRAGON","DRAWING","DREAM","DRESS","DRESSING","DRILL","DRIVER","DRONE","DROP","DRUM","DRYER","DUCK","DUST","DWARF","EAGLE","EAR","EARTH","EARTHQUAKE","EASTER","EDEN","EGG","EGYPT","EINSTEIN","ELEPHANT","EMBASSY","ENGINE","ENGLAND","EUROPE","EYE","FACE","FAIR","FALL","FAN","FARM","FENCE","FEVER","FIDDLE","FIELD","FIGHTER","FIGURE","FILE","FILM","FIRE","FISH","FLAG","FLAT","FLOOD","FLOOR","FLUTE","FLY","FOAM","FOG","FOOT","FORCE","FOREST","FORK","FRANCE","FROG","FROST","FUEL","GAME","GANGSTER","GARDEN","GAS","GEAR","GENIE","GENIUS","GERMANY","GHOST","GIANT","GLACIER","GLASS","GLASSES","GLOVE","GOAT","GOLD","GOLDILOCKS","GOLF","GOVERNOR","GRACE","GRASS","GREECE","GREEN","GREENHOUSE","GROOM","GROUND","GUITAR","GUM","GYMNAST","HAIR","HALLOWEEN","HAM","HAMBURGER","HAMMER","HAND","HAWAII","HAWK","HEAD","HEART","HELICOPTER","HELMET","HERCULES","HIDE","HIMALAYAS","HIT","HOLE","HOLLYWOOD","HOMER","HONEY","HOOD","HOOK","HORN","HORSE","HORSESHOE","HOSE","HOSPITAL","HOTEL","HOUSE","ICE","ICE AGE","ICE CREAM","ICELAND","IGLOO","INDIA","INK","IRON","IVORY","JACK","JAIL","JAM","JELLYFISH","JET","JEWELER","JOAN OF ARC","JOCKEY","JOKER","JUDGE","JUMPER","JUPITER","KANGAROO","KETCHUP","KEY","KICK","KID","KILT","KING","KING ARTHUR","KISS","KITCHEN","KIWI","KNIFE","KNIGHT","KNOT","KUNG FU","LAB","LACE","LADDER","LAP","LASER","LAUNDRY","LAWYER","LEAD","LEAF","LEATHER","LEMON","LEMONADE","LEPRECHAUN","LETTER","LIFE","LIGHT","LIGHTNING","LIMOUSINE","LINE","LINK","LION","LIP","LITTER","LOCH NESS","LOCK","LOCUST","LOG","LONDON","LOVE","LUCK","LUMBERJACK","LUNCH","MAGAZINE","MAGICIAN","MAIL","MAKEUP","MAMMOTH","MANICURE","MAP","MAPLE","MARACAS","MARATHON","MARBLE","MARCH","MARK","MASS","MATCH","MEDIC","MEMORY","MERCURY","MESS","METER","MEXICO","MICROSCOPE","MICROWAVE","MILE","MILK","MILL","MILLIONAIRE","MINE","MINOTAUR","MINT","MINUTE","MIRROR","MISS","MISSILE","MODEL","MOHAWK","MOLE","MONA LISA","MONKEY","MOON","MOSCOW","MOSES","MOSQUITO","MOTHER","MOUNT","MOUNTIE","MOUSE","MOUTH","MUD","MUG","MUMMY","MUSKETEER","MUSTARD","NAIL","NAPOLEON","NEEDLE","NERVE","NET","NEW YORK","NEWTON","NIGHT","NINJA","NOAH","NOSE","NOTE","NOTRE DAME","NOVEL","NURSE","NUT","NYLON","OASIS","OCTOPUS","OIL","OLIVE","OLYMPUS","ONION","OPERA","ORANGE","ORGAN","PACIFIC","PAD","PADDLE","PAGE","PAINT","PALM","PAN","PANTS","PAPER","PARACHUTE","PARADE","PARK","PARROT","PART","PASS","PASTE","PATIENT","PEA","PEACH","PEANUT","PEARL","PEN","PENGUIN","PENNY","PENTAGON","PEPPER","PEW","PHOENIX","PIANO","PIE","PIG","PILLOW","PILOT","PIN","PINE","PIPE","PIRATE","PISTOL","PIT","PITCH","PITCHER","PIZZA","PLANE","PLASTIC","PLATE","PLATYPUS","PLAY","PLOT","POCKET","POINT","POISON","POLE","POLICE","POLISH","POLO","POOL","POP","POPCORN","PORT","POST","POTATO","POTTER","POUND","POWDER","PRESS","PRINCESS","PUMPKIN","PUPIL","PUPPET","PURSE","PYRAMID","QUACK","QUARTER","QUEEN","RABBIT","RACKET","RADIO","RAIL","RAINBOW","RAM","RANCH","RAT","RAY","RAZOR","RECORD","REINDEER","REVOLUTION","RICE","RIFLE","RING","RIP","RIVER","ROAD","ROBIN","ROBOT","ROCK","RODEO","ROLL","ROME","ROOT","ROPE","ROSE","ROULETTE","ROUND","ROW","RUBBER","RULER","RUSSIA","RUST","SACK","SADDLE","SAHARA","SAIL","SALAD","SALOON","SALSA","SALT","SAND","SANTA","SATELLITE","SATURN","SAW","SCALE","SCARECROW","SCHOOL","SCIENTIST","SCORPION","SCRATCH","SCREEN","SCROLL","SCUBA DIVER","SEAL","SECOND","SERVER","SHADOW","SHAKESPEARE","SHAMPOO","SHARK","SHED","SHEET","SHELL","SHERLOCK","SHERWOOD","SHIP","SHOE","SHOOT","SHOP","SHORTS","SHOT","SHOULDER","SHOWER","SIGN","SILK","SINK","SISTER","SKATES","SKI","SKULL","SKYSCRAPER","SLED","SLEEP","SLING","SLIP","SLIPPER","SLOTH","SLUG","SMELL","SMOKE","SMOOTHIE","SMUGGLER","SNAKE","SNAP","SNOW","SNOWMAN","SOAP","SOCK","SOLDIER","SOUL","SOUND","SOUP","SPACE","SPELL","SPHINX","SPIDER","SPIKE","SPINE","SPIRIT","SPOON","SPOT","SPRAY","SPRING","SPURS","SPY","SQUARE","SQUASH","SQUIRREL","ST.PATRICK","STABLE","STADIUM","STAFF","STAMP","STAR","STATE","STEAM","STEEL","STEP","STETHOSCOPE","STICK","STICKER","STOCK","STORM","STORY","STRAW","STREAM","STREET","STRIKE","STRING","SUB","SUGAR","SUIT","SUMO","SUN","SUPERHERO","SWAMP","SWEAT","SWING","SWITCH","SWORD","TABLE","TABLET","TAG","TAIL","TANK","TAP","TASTE","TATTOO","TEA","TEACHER","TEAM","TEAR","TELESCOPE","TEMPLE","TEXAS","THEATER","THIEF","THUMB","THUNDER","TICK","TIE","TIGER","TIME","TIN","TIP","TIPI","TOAST","TOKYO","TOOTH","TORCH","TORNADO","TOWER","TRACK","TRAIN","TRIANGLE","TRICK","TRIP","TROLL","TRUNK","TUBE","TUNNEL","TURKEY","TURTLE","TUTU","TUXEDO","UNDERTAKER","UNICORN","UNIVERSITY","VACUUM","VALENTINE","VAMPIRE","VAN","VENUS","VET","VIKING","VIOLET","VIRUS","VOLCANO","VOLUME","WAGON","WAITRESS","WAKE","WALL","WALRUS","WAR","WASHER","WASHINGTON","WATCH","WATER","WAVE","WEB","WEDDING","WELL","WEREWOLF","WHALE","WHEEL","WHEELCHAIR","WHIP","WHISTLE","WIND","WINDOW","WING","WISH","WITCH","WIZARD","WONDERLAND","WOOD","WOOL","WORM","YARD","YELLOWSTONE","ZOMBIE"]')},12:function(e,n,t){e.exports=t(33)},17:function(e,n,t){},26:function(e,n){},32:function(e,n,t){},33:function(e,n,t){"use strict";t.r(n);var E=t(0),r=t.n(E),o=t(10),A=t.n(o),a=(t(17),t(7)),c=t(1),O=t(6),R=t(5),i=t(28),S=i.qrcode,T=i.svg2url,I="OFFER",s="ANSWER",L={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},N=!window.location.hash,l=function(e,n){var t,E,r=[],o=!1,A=new Promise(function(A,a){E=function(){if(o)console.error("Called accumulate after done accumulating");else{var E=n.apply(null,arguments);E&&r.push(E),t&&clearTimeout(t),t=setTimeout(function(){A(r),o=!0},e)}}});return{accumulate:E,promise:A}},C=function(e,n){return Promise.all([e,n]).then(function(e){var n=Object(c.a)(e,2);return{sdp:n[0],ice:n[1]}})},u=new Map,f=new Map,P={getRole:function(){return N?I:s},channelFrom:function(e){return u.get(e)},cancelOffer:function(e){return console.log("Cleanup",e,f),f.get(e)&&clearInterval(f.get(e)),!0},generateOffer:function(e){var n,t=new Promise(function(E,r){var o=new RTCPeerConnection(L),A=o.createDataChannel("c"),a=o.createOffer(),c=l(200,function(e){return e.candidate}),O=c.accumulate,R=c.promise;a.then(function(e){o.setLocalDescription(e),o.onicecandidate=O}),C(a,R).then(function(r){var a=parseInt(1e12*Math.random()).toString(),c=parseInt(1e12*Math.random()).toString();fetch("https://sipcup.azurewebsites.net/api/Answer/"+a,{method:"POST",mode:"cors",body:JSON.stringify(r)}).then(function(n){var t="".concat(window.location.href,"#").concat(a,":").concat(c,":").concat(e);E({url:t,svg:T(S(t))})});var O=setInterval(function(){fetch("https://sipcup.azurewebsites.net/api/Answer/"+c,{method:"GET",mode:"cors"}).then(function(e){return e.json()}).then(function(e){if(e.length>0){var t=JSON.parse(e[0]);o.setRemoteDescription(t.sdp),t.ice.forEach(function(e){o.addIceCandidate(new RTCIceCandidate(e))}),clearInterval(O),n(A)}})},1e3);f.set(t,O)})}),E=new Promise(function(e,t){n=e});return u.set(t,E),t},generateAnswer:function(){var e,n=new Promise(function(n,t){var E=decodeURIComponent(window.location.hash.slice(1)).split(":"),r=Object(c.a)(E,3),o=r[0],A=r[1];r[2];fetch("https://sipcup.azurewebsites.net/api/Answer/"+o,{method:"GET",mode:"cors"}).then(function(e){return e.json()}).then(function(e){return JSON.parse(e[0])}).then(function(n){var t=new RTCPeerConnection(L);t.ondatachannel=function(n){console.log("On data channel",n),e(n.channel)},t.setRemoteDescription(n.sdp).then(function(){n.ice.forEach(function(e){t.addIceCandidate(new RTCIceCandidate(e))})});var E=t.createAnswer();E.then(function(e){t.setLocalDescription(e)});var r=l(200,function(e){return e.candidate}),o=r.accumulate,a=r.promise;t.onicecandidate=o,C(E,a).then(function(e){fetch("https://sipcup.azurewebsites.net/api/Answer/"+A,{method:"POST",mode:"cors",body:JSON.stringify(e)})})})}),t=new Promise(function(n,t){e=n});return u.set(n,t),n}},d=(t(32),t(8)),D=t(11);function U(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(e);n&&(E=E.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,E)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?U(t,!0).forEach(function(n){Object(a.a)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}window.location.href.match("http://joshuamandel.com")&&(window.location.href=window.location.href.replace("http://","https://")),window.channels={};var M=parseInt(1e9*Math.random()),p={BLUE:"BLUE",RED:"RED",NEUTRAL:"NEUTRAL",BLACK:"BLACK"},B=[p.BLACK].concat(Object(O.a)(Array(7).fill().map(function(e){return p.BLUE})),Object(O.a)(Array(7).fill().map(function(e){return p.RED})),Object(O.a)(Array(9).fill().map(function(e){return p.NEUTRAL})));function m(e){var n=Object(E.useState)({}),t=Object(c.a)(n,2),o=t[0],A=t[1];return Object(E.useEffect)(function(){var n=P.generateOffer(e.role);return n.then(function(e){var n=e.url,t=e.svg;A({url:n,svg:t,completed:!1})}),P.channelFrom(n).then(function(n){A({completed:!0}),e.onChannel(e.offerId,n)}),function(){console.log("Cleanup",e),P.cancelOffer(n)}},[e.offerId,e.role]),o.completed?r.a.createElement("img",{className:e.className+" done",src:e.offerImage}):r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:o.url},o.url&&r.a.createElement("img",{src:o.svg,alt:"",className:e.className}))}var h={REVEAL_CARD:"REVEAL_CARD",INITIALIZE:"INITIALIZE",PICK_SEED:"PICK_SEED"},K={turns:[]},G=decodeURIComponent(window.location.hash.slice(1)).split(":")[2];var v=function(e){var n=Object(E.useReducer)(function(e,n){return n.type===h.INITIALIZE?K:n.type===h.REVEAL_CARD?H({},e,{turns:e.turns.concat([n])}):n.type===h.PICK_SEED?(console.log("Picked seed",n),H({},e,{seed:n.seed,turns:[]})):void 0},K),t=Object(c.a)(n,2),o=t[0],A=t[1],a=Object(E.useState)(!1),O=Object(c.a)(a,2),i=O[0],S=O[1],T=o.seed||e.initialSeed,I=function(e){return Object(R.shuffle)(B.concat(Object(R.shuffle)([p.RED,p.BLUE],e).slice(0,1)),e)}(T),s=function(e){return Object(R.shuffle)(D,e)}(T).slice(0,25).map(function(e,n){return{word:e,revealed:o.turns.some(function(n){return n.type===h.REVEAL_CARD&&n.word==e}),color:I[n]}}),L=o.turns.filter(function(e){return e.type===h.REVEAL_CARD}).map(function(e){return H({},e,{color:(n=e.word,s.filter(function(e){return e.word===n}).map(function(e){return e.color})[0])});var n}).reduce(function(e,n){var t=n.word,E=n.color;return E===(e.length>0?e[e.length-1][0].color:"START")?e[e.length-1].push({word:t,color:E}):e.push([{word:t,color:E}]),e},[]),N=(L.length>0?L[L.length-1]:[]).map(function(e){return e.word}),l=(L.length>1?L[L.length-2]:[]).map(function(e){return e.word});console.log(I),Object(E.useEffect)(function(){if(e.externalEvents){e.externalEvents.on("received",A);return function(){return e.externalEvents.off("received",A)}}},[e.externalEvents]);var C=function(n){console.log("Gameboard sipatch",n,e),e.broadcastAction&&e.broadcastAction(n),A(n)};return r.a.createElement("div",{className:"grid-container"},r.a.createElement("div",{className:"header"},r.a.createElement("button",{onClick:function(e){return C({type:h.PICK_SEED,seed:Math.random()})}},"Deal New Cards"),r.a.createElement("button",{onClick:function(e){return S(!i)}},i?"Player View":"Spymaster View")),T&&s.map(function(n,t){var E=n.word,o=n.revealed,A=n.color;return r.a.createElement("p",{className:"card ".concat(A," c").concat(t," ").concat(o?"revealed":"hidden","\n            ").concat(i?"spymaster":"non-spymaster","\n            ").concat(N.includes(E)?"minus1":"","\n            ").concat(l.includes(E)?"minus2":"","\n            "),onClick:function(n){return C({type:h.REVEAL_CARD,playerRole:e.role,playerId:M,word:E})},key:E},r.a.createElement("span",{className:"word"},E))}),r.a.createElement("p",null),!1)},w=P.getRole()===I?function(){var e=Object(E.useState)({}),n=Object(c.a)(e,2),t=n[0],o=n[1],A=Object(E.useRef)(new d.EventEmitter),O=Object(E.useState)(""),R=Object(c.a)(O,2),i=(R[0],R[1],Object(E.useState)(0)),S=Object(c.a)(i,2),T=S[0],I=S[1],s=Object(E.useState)(!1),L=Object(c.a)(s,2),N=L[0],l=L[1],C=Object(E.useRef)(Math.random()),u=function(e){Object.values(t).forEach(function(n){try{n.send(JSON.stringify(e))}catch(t){console.log("Failed to send",e,n)}}),e.playerId!==M&&A.current.emit("received",e)};Object(E.useEffect)(function(){Object.values(t).forEach(function(e){return e.onmessage=function(e){var n=JSON.parse(e.data);u(n)}})},[t]);var f=function(e,n){n.onopen=function(){return n.send(JSON.stringify({type:h.PICK_SEED,seed:C.current}))},o(function(t){return H({},t,Object(a.a)({},e,n))}),e>1&&I(function(e){return e+1})};return r.a.createElement("div",{className:"App"},!N&&r.a.createElement("div",{className:"offer-lkk"},r.a.createElement("div",{className:"player-card"},r.a.createElement(m,{offerId:0,role:"red-team",className:"player-icon red",offerImage:"assets/player.004.svg",onChannel:f}),"Red Captain"),r.a.createElement("div",{className:"player-card"},r.a.createElement(m,{offerId:1,role:"blue-team",className:"player-icon blue",offerImage:"assets/player.005.svg",onChannel:f}),"Blue Captain"),r.a.createElement("div",{className:"player-card"},r.a.createElement(m,{offerId:2+T,role:"other-player",className:"player-icon",offerImage:"assets/player.003.svg",onChannel:f}),"Other Players ",T>0&&" (".concat(T,")")),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(e){return l(!0)}},"Start Game"))),N&&r.a.createElement(v,{initialSeed:C.current,role:"other-player",broadcastAction:u,externalEvents:A.current}))}:function(){var e=Object(E.useState)(""),n=Object(c.a)(e,2),t=(n[0],n[1]),o=Object(E.useState)(!1),A=Object(c.a)(o,2),a=A[0],O=A[1],R=Object(E.useRef)(new d.EventEmitter),i=Object(E.useState)({current:function(e){return!0}}),S=Object(c.a)(i,2),T=S[0],I=S[1];return Object(E.useEffect)(function(){var e=P.generateAnswer(),n=null;P.channelFrom(e).then(function(e){O(!0),n=e,e.onmessage=function(e){var n=JSON.parse(e.data);t(JSON.stringify(n)),n.playerId!==M&&R.current.emit("received",n)},I({current:function(e){n.send(JSON.stringify(e))}}),window.channel=e})},[]),r.a.createElement("div",{className:"App"},a&&r.a.createElement(v,{role:G,externalEvents:R.current,broadcastAction:T.current}))},g=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function W(e,n){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}A.a.render(r.a.createElement(w,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/eu",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var n="".concat("/eu","/service-worker.js");g?(!function(e,n){fetch(e).then(function(t){var E=t.headers.get("content-type");404===t.status||null!=E&&-1===E.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):W(e,n)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(n,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):W(n,e)})}}()}},[[12,1,2]]]);
//# sourceMappingURL=main.040fd650.chunk.js.map